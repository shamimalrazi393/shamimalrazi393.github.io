<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shamim Al Razi | BUET MME Student</title>
  <link rel="icon" href="favicon.ico" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f7fa;
      color: #333;
    }
    header {
      background-color: #2c3e50;
      padding: 30px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .logo {
      height: 80px;
    }
    .profile {
      height: 80px;
      width: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #fff;
      box-shadow: 0 0 5px rgba(0,0,0,0.4);
    }
    .header-text {
      flex: 1;
      text-align: center;
      color: white;
    }
    .header-text h1 {
      margin: 10px 0 5px;
      font-size: 24px;
    }
    .header-text p {
      margin: 0;
      font-size: 16px;
    }
    nav {
      background-color: #34495e;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 25px;
      padding: 12px 0;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.3s;
    }
    nav a:hover {
      color: #ffd700;
    }
    section {
      padding: 40px 20px;
      max-width: 900px;
      margin: auto;
      background: #fff;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      border-bottom: 2px solid #ccc;
      padding-bottom: 8px;
      margin-bottom: 20px;
      color: #2c3e50;
    }
    input, button {
      font-size: 16px;
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #c0392b;
    }
    .upload-author-only {
      display: none;
      margin-bottom: 20px;
    }
    #youtube-videos iframe {
      margin: 10px;
    }
    footer {
      background-color: #2c3e50;
      color: white;
      text-align: center;
      padding: 30px 20px;
      font-size: 15px;
    }
    #change-pass-section {
      max-width: 400px;
      margin: 30px auto 50px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: none;
    }
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }
    .file-item a {
      word-break: break-all;
    }
    .file-item button {
      width: auto;
      padding: 5px 10px;
      font-size: 14px;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <header>
    <img src="buet-logo.png" alt="BUET Logo" class="logo" />
    <div class="header-text">
      <h1>Md. Shamim Al Razi</h1>
      <p>Materials & Metallurgical Engineering Student | BUET</p>
    </div>
    <img src="profile.jpg" alt="Shamim Al Razi" class="profile" />
  </header>

  <nav>
    <a href="#fusion">Fusion Shilpigosti</a>
    <a href="#publications">Publications</a>
    <a href="#writings">Writings</a>
    <a href="#contact">Contact</a>
  </nav>

  <!-- Author Login -->
  <div id="author-login" style="text-align:center; margin: 20px;">
    <h3>Author Login</h3>
    <input type="text" id="author-id" placeholder="Author ID" autocomplete="username" /><br/>
    <input type="password" id="author-password" placeholder="Password" autocomplete="current-password" /><br/>
    <button onclick="checkAuthorLogin()">Login</button>
  </div>

  <!-- Logout -->
  <div id="author-logout" style="display:none; text-align:center; margin: 20px;">
    <h3>Welcome, Author!</h3>
    <button onclick="signOutAuthor()">Sign Out</button>
  </div>

  <section id="fusion">
    <h2>Fusion Shilpigosti</h2>
    <p>Explore music and videos under Fusion Shilpigosti.</p>
    <a class="button" href="https://youtube.com/@fusion_393" target="_blank" rel="noopener">Watch on YouTube</a>
    <a class="button" href="https://www.facebook.com/fusion393" target="_blank" rel="noopener">Visit Facebook Page</a>

    <div class="upload-author-only">
      <h3>Upload Your Music or Video</h3>
      <input type="file" id="fusionUpload" accept="video/*,audio/*" />
      <button onclick="uploadFile('fusionUpload', 'fusion')">Upload</button>
    </div>

    <h3>Public Downloads</h3>
    <div class="download-list" id="fusion-files">Loading files...</div>

    <h3>Latest YouTube Videos</h3>
    <div id="youtube-videos">Loading videos...</div>
  </section>

  <section id="publications">
    <h2>Publications</h2>
    <div class="upload-author-only">
      <input type="file" id="pubUpload" accept="application/pdf" />
      <button onclick="uploadFile('pubUpload', 'publications')">Upload</button>
    </div>
    <div class="download-list" id="publication-files">Loading files...</div>
  </section>

  <section id="writings">
    <h2>Writings</h2>
    <div class="upload-author-only">
      <input type="file" id="writeUpload" accept=".txt,.pdf,.docx" />
      <button onclick="uploadFile('writeUpload', 'writings')">Upload</button>
    </div>
    <div class="download-list" id="writing-files">Loading files...</div>
  </section>

  <section id="contact">
    <h2>Contact Me</h2>
    <p>Email: <a href="mailto:shamim393393@gmail.com">shamim393393@gmail.com</a></p>
    <p>Phone: <a href="tel:+8801628912047">01628912047</a></p>
    <p>LinkedIn: <a href="https://www.linkedin.com/in/shamim393/" target="_blank" rel="noopener">linkedin.com/in/shamim393</a></p>
    <p>Facebook: <a href="https://www.facebook.com/md.shamimalrazi.393/" target="_blank" rel="noopener">md.shamimalrazi.393</a></p>
    <p>Twitter: <a href="https://x.com/Shamim393" target="_blank" rel="noopener">@Shamim393</a></p>
  </section>

  <!-- Password Change Section -->
  <section id="change-pass-section">
    <h2>Change Author ID & Password</h2>
    <input type="text" id="new-author-id" placeholder="New Author ID" autocomplete="username" />
    <input type="password" id="new-author-pass" placeholder="New Password" autocomplete="new-password" />
    <button onclick="changeAuthorCredentials()">Save Changes</button>
  </section>

  <footer>
    <p>&copy; 2025 Md. Shamim Al Razi. All rights reserved.</p>
  </footer>

  <script>
    // Server URL - Replace with your deployed web app URL
    const SERVER_URL = "https://script.google.com/macros/s/AKfycbzFPc-oOl6sBB0khxc_2rd2MxDEB8nujcxxd4-xB65amh3qFhJGzK8RmF4wLaj9Rpch/exec";
    
    // Initialize author credentials
    let AUTHOR_ID = localStorage.getItem("author_id") || "admin";
    let AUTHOR_PASSWORD = localStorage.getItem("author_pass") || "123456";
    let isAuthorLoggedIn = false;

    // Check login credentials
    function checkAuthorLogin() {
      const id = document.getElementById("author-id").value.trim();
      const pass = document.getElementById("author-password").value.trim();
      
      fetch(`${SERVER_URL}?action=getCredentials`)
        .then(res => res.json())
        .then(credentials => {
          if (id === credentials.author_id && pass === credentials.author_pass) {
            isAuthorLoggedIn = true;
            AUTHOR_ID = id;
            AUTHOR_PASSWORD = pass;
            localStorage.setItem("author_id", id);
            localStorage.setItem("author_pass", pass);
            alert("Login successful!");
            toggleLoginUI();
            loadFilesFromServer();
          } else {
            alert("Invalid credentials.");
          }
        })
        .catch(() => alert("Error verifying credentials"));
    }

    // Sign out author
    function signOutAuthor() {
      isAuthorLoggedIn = false;
      toggleLoginUI();
    }

    // Toggle UI elements based on login state
    function toggleLoginUI() {
      document.getElementById("author-login").style.display = isAuthorLoggedIn ? "none" : "block";
      document.getElementById("author-logout").style.display = isAuthorLoggedIn ? "block" : "none";
      document.getElementById("change-pass-section").style.display = isAuthorLoggedIn ? "block" : "none";

      document.querySelectorAll('.upload-author-only').forEach(el => {
        el.style.display = isAuthorLoggedIn ? "block" : "none";
      });

      if (!isAuthorLoggedIn) {
        document.getElementById("author-id").value = "";
        document.getElementById("author-password").value = "";
      }
    }

    // Upload file to server
    function uploadFile(inputId, section) {
      if (!isAuthorLoggedIn) {
        alert("Please login as author to upload.");
        return;
      }
      
      const input = document.getElementById(inputId);
      const file = input.files[0];
      if (!file) return alert("Please select a file first.");

      const formData = new FormData();
      formData.append("file", file);
      formData.append("action", "upload");
      formData.append("section", section);

      fetch(SERVER_URL, {
        method: "POST",
        body: formData
      })
      .then(response => {
        if (!response.ok) throw new Error("Network response was not ok");
        return response.json();
      })
      .then(data => {
        if (data.success) {
          alert("Upload successful!");
          input.value = "";
          loadFilesFromServer();
        } else {
          throw new Error(data.error || "Upload failed");
        }
      })
      .catch(error => {
        console.error("Upload error:", error);
        alert("Upload failed: " + error.message);
      });
    }

    // Delete file from server
    function deleteFile(section, fileName) {
      if (!isAuthorLoggedIn) {
        alert("Please login as author to delete files.");
        return;
      }
      if (!confirm("Are you sure you want to delete this file?")) return;

      fetch(SERVER_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          action: "delete",
          section: section,
          name: fileName
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("Deleted successfully.");
          loadFilesFromServer();
        } else {
          throw new Error(data.error || "Failed to delete");
        }
      })
      .catch(error => {
        console.error("Delete error:", error);
        alert("Delete failed: " + error.message);
      });
    }

    // Load files from server
    function loadFilesFromServer() {
      fetch(`${SERVER_URL}?action=list`)
        .then(res => res.json())
        .then(data => {
          if (data.files) {
            renderFiles(data.files);
          } else {
            throw new Error("Invalid response format");
          }
        })
        .catch(error => {
          console.error("Error loading files:", error);
          document.querySelectorAll('.download-list').forEach(el => {
            el.textContent = "Failed to load files. Please try again later.";
          });
        });
    }

    // Render files in the UI
    function renderFiles(files) {
      // Fusion files
      const fusionDiv = document.getElementById("fusion-files");
      fusionDiv.innerHTML = files.fusion.length === 0 ? 
        "No files available." : 
        files.fusion.map(file => `
          <div class="file-item">
            <a href="${file.url}" target="_blank" rel="noopener">${file.name}</a>
            ${isAuthorLoggedIn ? `<button onclick="deleteFile('fusion', '${file.name}')">Delete</button>` : ''}
          </div>
        `).join('');

      // Publication files
      const pubDiv = document.getElementById("publication-files");
      pubDiv.innerHTML = files.publications.length === 0 ? 
        "No files available." : 
        files.publications.map(file => `
          <div class="file-item">
            <a href="${file.url}" target="_blank" rel="noopener">${file.name}</a>
            ${isAuthorLoggedIn ? `<button onclick="deleteFile('publications', '${file.name}')">Delete</button>` : ''}
          </div>
        `).join('');

      // Writing files
      const writeDiv = document.getElementById("writing-files");
      writeDiv.innerHTML = files.writings.length === 0 ? 
        "No files available." : 
        files.writings.map(file => `
          <div class="file-item">
            <a href="${file.url}" target="_blank" rel="noopener">${file.name}</a>
            ${isAuthorLoggedIn ? `<button onclick="deleteFile('writings', '${file.name}')">Delete</button>` : ''}
          </div>
        `).join('');
    }

    // Fetch YouTube videos
    function fetchVideos() {
      const channelId = "UCZpabp4C9ttk68-G1_SOsJQ";
      const apiKey = "AIzaSyC0Z9fSpsm-GUipCRgG0XJTeKTvRza0pFU";
      
      fetch(`https://www.googleapis.com/youtube/v3/search?key=${apiKey}&channelId=${channelId}&part=snippet,id&order=date&maxResults=4`)
        .then(res => res.json())
        .then(data => {
          const videosDiv = document.getElementById('youtube-videos');
          videosDiv.innerHTML = '';
          
          if (!data.items || data.items.length === 0) {
            videosDiv.textContent = 'No videos found.';
            return;
          }
          
          data.items.forEach(item => {
            if (item.id.kind === "youtube#video") {
              const iframe = document.createElement('iframe');
              iframe.width = "320";
              iframe.height = "180";
              iframe.src = `https://www.youtube.com/embed/${item.id.videoId}`;
              iframe.allowFullscreen = true;
              videosDiv.appendChild(iframe);
            }
          });
        })
        .catch(() => {
          document.getElementById('youtube-videos').textContent = 'Failed to load videos.';
        });
    }

    // Change author credentials
    function changeAuthorCredentials() {
      if (!isAuthorLoggedIn) {
        alert("Please login first.");
        return;
      }
      
      const newId = document.getElementById("new-author-id").value.trim();
      const newPass = document.getElementById("new-author-pass").value.trim();
      
      if (newId.length < 3 || newPass.length < 3) {
        alert("Author ID and Password must be at least 3 characters.");
        return;
      }
      
      if (!confirm("Change Author ID and Password? You will be logged out after this.")) return;

      fetch(SERVER_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          action: "changeCredentials",
          newId: newId,
          newPass: newPass
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("Author credentials changed. Please log in again.");
          document.getElementById("new-author-id").value = "";
          document.getElementById("new-author-pass").value = "";
          signOutAuthor();
        } else {
          throw new Error(data.error || "Failed to change credentials");
        }
      })
      .catch(error => {
        console.error("Error changing credentials:", error);
        alert("Failed to change credentials: " + error.message);
      });
    }

    // Initialize on page load
    window.onload = () => {
      fetchVideos();
      toggleLoginUI();
      loadFilesFromServer();
    };
  </script>
</body>
</html>
